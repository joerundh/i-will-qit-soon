import{bw as g,bx as P,a as s,a$ as S,aV as _,cy as x,bY as E,cz as M,cA as k,cB as R,c3 as $,cC as y,a9 as v,cx as D,cD as O,cu as U,bO as j}from"./sanity.config-CjznIsCa.js";function F(u){return g(function(t,r){var i=!1,n=0;t.subscribe(P(r,function(a){return(i||(i=!u(a,n++)))&&r.next(a)}))})}const I=u=>{const{comlink:t,refs:r,perspective:i}=u,n=S(),a=_(),p=s.useMemo(()=>new x,[]),l=s.useMemo(()=>p.asObservable().pipe(E(b=>k(b.map(e=>{const f={...e,_id:R(e._id)},m=i==="published"?$:n.observeForPreview(f,a.get(f._type)).pipe(y(),F(o=>o.snapshot===null)),h={...e,_id:v(e._id)},w=n.observeForPreview(h,a.get(h._type));return D(w.pipe(O(m)),m).pipe(U(o=>!!o.snapshot),j(o=>{const c=o.snapshot;return{_id:v(c._id),title:c.title,subtitle:c.subtitle,description:c.description,imageUrl:c.imageUrl}}))}))),M(0)),[n,p,a,i]),d=s.useRef([]);return s.useEffect(()=>{const b=l.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,l]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{p.next(r)},[r,p]),null};var z=s.memo(I);export{z as default};
